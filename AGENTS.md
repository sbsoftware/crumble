# Repository Guidelines

## Project Structure & Module Organization
- `src/` holds runtime code; notable areas: `src/server/` (HTTP + session stack), `src/page/` (page rendering), `src/form/`, `src/resource/`, and `src/cli.cr` for the `crumble` executable. Templates for the generator live in `src/cli/templates/`.
- `spec/` mirrors the code layout (`spec/server`, `spec/page`, etc.) and contains helper contexts in `spec/test_*` files.
- `bin/` contains built binaries (`crumble`, `protoc-gen-crystal`), regenerated by builds. `lib/` is vendor code managed by shards.

## Build, Test, and Development Commands
- `shards install` — install Crystal dependencies defined in `shard.yml`.
- `shards build crumble` — compile the CLI; output lands in `bin/crumble`.
- `crystal spec` — run the full test suite. Narrow scope with `crystal spec spec/server/handler_context_spec.cr` for quicker loops.

## Coding Style & Naming Conventions
- Crystal defaults: 2-space indentation, trailing commas allowed, double quotes for interpolated strings, snake_case methods/files, CamelCase types.
- Run `crystal tool format` before committing; keep generated files and templates consistent with existing style.
- Prefer small modules under domain directories (e.g., new HTTP helpers in `src/server/`, new UI pieces in `src/page/`).

## Testing Guidelines
- Add or update specs alongside code (`*_spec.cr`); mirror paths so new server code has a matching `spec/server/..._spec.cr`.
- Use the provided request/handler context helpers in `spec/test_request_context.cr` and `spec/test_handler_context.cr` to avoid custom stubs.
- Aim to cover the happy path plus one failure case; keep fixtures minimal and reusable.
